---
title: –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç
---
# –î–æ—Å–µ–≥–∞

::: incremental

* –ü—Ä–æ–≥—Ä–∞–º–∏ —Å –º–æ—â–Ω–æ—Å—Ç—Ç–∞ –Ω–∞ –ª–∞–º–±–¥–∞ —Å–º—è—Ç–∞–Ω–µ—Ç–æ/–º–∞—à–∏–Ω–∞—Ç–∞ –Ω–∞ –¢—é—Ä–∏–Ω–≥
* –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª–Ω–∏ –∏–∑—á–∏—Å–ª–µ–Ω–∏—è, –Ω–µ —Å–µ –≤–ª–∏—è—è—Ç –æ—Ç –≤—Ä–µ–º–µ—Ç–æ
* –ù—è–º–∞—Ç –≤—Ä—ä–∑–∫–∞ —Å –æ–∫–æ–ª–Ω–∏—è —Å–≤—è—Ç
* –≤—Ö–æ–¥ =&gt; –ø—Ä–µ–¥–≤–∏–¥–∏–º–∞ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è =&gt; –∏–∑—Ö–æ–¥
* –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∏—Ä–∞—â–∏ –ø—Ä–æ–≥—Ä–∞–º–∏
* –î–æ–±—Ä–µ –∏–∑—É—á–µ–Ω–∏, "–ª–µ—Å–Ω–∏"

:::

# IO

```scala
import Console._

val program = for {
  _     <- putStrLn("What is your name?")
  name  <- getStrLn
  _     <- putStrLn("Hello, " + name + ", welcome!")
} yield ()

program.unsafeRun()

doSomethingElse()
```

::: incremental

* –í—Ä—ä–∑–∫–∞ —Å –≤—ä–Ω—à–Ω–∏—è —Å–≤—è—Ç
* –ù–æ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞ ‚Äì –ø—Ä–æ–≥—Ä–∞–º–∞—Ç–∞ –Ω–µ –ø—Ä–∞–≤–∏ –Ω–∏—â–æ –¥—Ä—É–≥–æ –¥–æ–∫–∞—Ç–æ —á–∞–∫–∞
* –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∏ –ø—Ä–æ–≥—Ä–∞–º–∏

:::

# –†–µ–∞–ª–Ω–∏—è—Ç —Å–≤—è—Ç

::: incremental

* –°–≤–µ—Ç—ä—Ç –Ω–∞–≤—ä–Ω –µ —Å–∏–ª–Ω–æ –ø–∞—Ä–∞–ª–µ–ª–µ–Ω –∏ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–µ–Ω
* –ù–µ—â–æ –ø–æ–≤–µ—á–µ, —É—á–∞—Å—Ç–Ω–∏—Ü–∏—Ç–µ –≤ –Ω–µ–≥–æ —Å–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∞—Ç
* –†–∞–∑–≤–∏–≤–∞ —Å–µ –≤—ä–≤ –≤—Ä–µ–º–µ—Ç–æ
* –ö–∞–∫ –¥–∞ –º–æ–¥–µ–ª–∏—Ä–∞–º–µ —Ç–∞–∫–∏–≤–∞ –ø—Ä–æ–≥—Ä–∞–º–∏?

:::

# –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç –∏ –ø–∞—Ä–∞–ª–µ–ª–∏–∑—ä–º


<div class="align">
  <dl class="fragment">
    <dt>parallel</dt>
    <dd>from œÄŒ±œÅŒ¨ + ·ºÑŒªŒªŒ∑ŒªŒøœÇ, along each other</dd>
  </dl>

  <dl class="fragment">
    <dt>concurrent</dt>
    <dd>present active participle of concurr≈ç (‚Äúhappen at the same time with‚Äù), from con- (‚Äúwith‚Äù) + curr≈ç (‚Äúrun‚Äù)</dd>
  </dl>

  <dl class="fragment">
    <dt>concurrent computing</dt>
    <dd>a form of computing in which several computations are executed during overlapping time periods‚Äîconcurrently‚Äîinstead of sequentially</dd>
  </dl>
</div>

# –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç

–í –∏–∑—á–∏—Å–ª–∏—Ç–µ–ª–µ–Ω –∫–æ–Ω—Ç–µ–∫—Å—Ç:

::: incremental

* _–∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—Ç–∞_ —Å–µ –æ—Ç–Ω–∞—Å—è –∫—ä–º —Å—Ç—Ä—É–∫—Ç—É—Ä–∞—Ç–∞ –Ω–∞ –ø—Ä–æ–≥—Ä–∞–º–∞—Ç–∞,
* _–ø–∞—Ä–∞–ª–µ–ª–∏–∑–º—ä—Ç_, _–¥–∏—Å—Ç—Ä–∏–±—É—Ç–∏—Ä–∞–Ω–æ—Å—Ç—Ç–∞_ ‚Äì –∫—ä–º —Ö–∞—Ä–¥—É–µ—Ä–∞ –∏ –∫–∞–∫ —Ç—è —â–µ –±—ä–¥–µ –∏–∑–ø—ä–ª–Ω—è–≤–∞–Ω–∞.

:::

<p class=fragment>–ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–∏—Ç–µ –ø—Ä–æ–≥—Ä–∞–º–∏ —Å–∞ –∫–æ–º–ø–æ–∑–∏—Ç–Ω–æ—Å—Ç –æ—Ç unit-–∏ –æ—Ç –∏–∑—á–∏—Å–ª–µ–Ω–∏—è, –∫–æ–∏—Ç–æ, –≤–µ–¥–Ω—ä–∂ –¥–µ—Ñ–∏–Ω–∏—Ä–∞–Ω–∏, –º–æ–≥–∞—Ç –¥–∞ –±—ä–¥–∞—Ç –∏–∑–ø—ä–ª–Ω–µ–Ω–∏ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –µ–¥–Ω–æ –æ—Ç –¥—Ä—É–≥–æ.</p>

# –î–∏—Å—Ç—Ä–∏–±—É—Ç–∏—Ä–∞–Ω–æ—Å—Ç

::: { .fragment }

–ù–µ–∑–∞–≤–∏—Å–∏–º–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ —Å—ä—Å —Å–æ–±—Å—Ç–≤–µ–Ω–∏ –∏–∑—á–∏—Å–ª–∏—Ç–µ–ª–Ω–∏ —Ä–µ—Å—É—Ä—Å–∏ –∏ –ø–∞–º–µ—Ç, –∫–æ–∏—Ç–æ –∫–æ–º—É–Ω–∏–∫–∏—Ä–∞—Ç –ø–æ–º–µ–∂–¥—É —Å–∏ —á—Ä–µ–∑ —Å—ä–æ–±—â–µ–Ω–∏—è –∏ –∏–∑–≥—Ä–∞–∂–¥–∞—Ç —Ü—è–ª–æ—Å—Ç–Ω–∞ —Å–∏—Å—Ç–µ–º–∞

:::

::: { .fragment }

> "A distributed system is one in which the failure of a computer you didn't even know existed can render your own computer unusable."

:::

# –†–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç

<p class="fragment">–°–≤–æ–π—Å—Ç–≤–æ—Ç–æ –Ω–∞ –ø—Ä–æ–≥—Ä–∞–º–∏—Ç–µ/–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏—Ç–µ –¥–∞ —Ä–µ–∞–≥–∏—Ä–∞—Ç<br />–Ω–∞ —Å–≤–µ—Ç–∞ –æ–∫–æ–ª–æ —Ç—è—Ö<span class="fragment"> (—Å –∫–æ–µ—Ç–æ –¥–∞ —Å–∞ —á–∞—Å—Ç –æ—Ç –Ω–µ–≥–æ)</span></p>

# –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–∏ –º–æ–¥–µ–ª–∏

::: incremental

* –û—Ç –Ω–∏—Å–∫–æ –Ω–∏–≤–æ
  * –ù–∏—à–∫–∏
  * I/O –∏ TCP/IP –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç
* –ê–±—Å—Ç—Ä–∞–∫—Ü–∏–∏
  * Callbacks & event loop
  * Future/Promise & IO
  * –ê–∫—Ç—å–æ—Ä—Å–∫–∏ –º–æ–¥–µ–ª
  * Communicating Sequential Processes
  * Stream/dataflow –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç
  * ...–Ω–µ—â–æ –¥—Ä—É–≥–æ?
  
:::

# –ö–∞–∫–≤–æ –±–∏ –Ω–∞–ø—Ä–∞–≤–∏–ª–æ –µ–¥–∏–Ω –º–æ–¥–µ–ª –ø–æ–¥—Ö–æ–¥—è—â?

::: incremental

* Ease to reason about it
* Expressive
* Safe
* Doesn't hide possibility for errors<span class="fragment"> (e.g. in a distributed setting)</span>
* Composable
* Functional programming to the rescue

:::

# –ù–∏—à–∫–∏

* –ö–æ–π –µ –ø–æ–ª–∑–≤–∞–ª –ù–ò–®–ö–ò?

# –ö–∞–∫ —Å–∏ –∫–æ–º—É–Ω–∏–∫–∏—Ä–∞—Ç –Ω–∏—à–∫–∏—Ç–µ?

![](images/02-fp-with-scala/java-memory-model-multithreaded.jpg)

# ...—á—Ä–µ–∑ —Å–ø–æ–¥–µ–ª–µ–Ω–æ —Å—ä—Å—Ç–æ—è–Ω–∏–µ!

::: incremental

* –ó–∞ –¥–∞ –±—ä–¥–µ —Å–º–∏—Å–ª–µ–Ω, –≤—Å–µ–∫–∏ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–µ–Ω –ø—Ä–∏–º–∏—Ç–∏–≤ –µ –Ω—É–∂–Ω–æ –¥–∞ –∏–º–∞ –ø–æ–Ω–µ –µ–¥–Ω–∞ –∏–Ω—Ç–µ—Ä–∞–∫—Ü–∏—è —Å –æ–∫–æ–ª–Ω–∏—è —Å–≤—è—Ç –∏–ª–∏ —Å –¥—Ä—É–≥–∏ –ø—Ä–∏–º–∏—Ç–∏–≤–∏
* –ì—Ä–∞–Ω–∏—Ü–∏—Ç–µ —Å –¥–∏—Å—Ç—Ä–∏–±—É—Ç–∏—Ä–∞–Ω–∏—Ç–µ —Å–∏—Å—Ç–µ–º–∏ —Å–µ —Ä–∞–∑–º–∏–≤–∞—Ç
* –ù–∏—à–∫–∏ ‚Äì —á—Ä–µ–∑ —Å–ø–æ–¥–µ–ª–µ–Ω–∞ –ø–∞–º–µ—Ç –∏ —Å—Ä–µ–¥—Å—Ç–≤–∞ –Ω–∞ –ø—Ä–æ—Ü–µ—Å–æ—Ä–∞ –∏ –û–°
* –ú–æ–¥–µ–ª –Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è:

  ![](./images/08-concurrency/dijkstra.jpg){ height=420 }

:::

# –í–∏–¥–∏–º–æ—Å—Ç –º–µ–∂–¥—É –Ω–∏—à–∫–∏

::: { .fragment }

![](images/08-concurrency/cpu-cache.jpeg){ height=380 }

:::

::: { .fragment }

–í–∏–¥–∏–º–æ—Å—Ç —á—Ä–µ–∑ `volatile`

:::

# Happens-before

::: incremental

* –ó–∞–ø–∏—Å –≤—ä–≤ `volatile` –ø—Ä–æ–º–µ–Ω–ª–∏–≤–∞ __—Å–µ —Å–ª—É—á–≤–∞ –ø—Ä–µ–¥–∏__ –ø–æ—Å–ª–µ–¥–≤–∞—â–æ –Ω–µ–π–Ω–æ –ø—Ä–æ—á–∏—Ç–∞–Ω–µ (–æ—Ç —Å—ä—â–∞—Ç–∞ –∏–ª–∏ –¥—Ä—É–≥–∞ –Ω–∏—à–∫–∞)
* –ó–∞ –≤—Å–µ–∫–∏ –¥–≤–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª–Ω–∏ statement-–∞ –≤ –µ–¥–Ω–∞ –Ω–∏—à–∫–∞, –ø—ä—Ä–≤–∏—è—Ç __—Å–µ —Å–ª—É—á–≤–∞ –ø—Ä–µ–¥–∏__ –≤—Ç–æ—Ä–∏—è—Ç
* –†–µ–ª–∞—Ü–∏—è—Ç–∞ –µ —Ç—Ä–∞–Ω–∑–∏—Ç–∏–≤–Ω–æ –∑–∞—Ç–≤–æ—Ä–µ–Ω–∞

:::

::: { .fragment } 

–û–±—Ä–∞–∑—É–≤–∞ —Å–µ —á–∞—Å—Ç–∏—á–Ω–∞ –Ω–∞—Ä–µ–¥–±–∞

:::

# Happens-before

::: incremental

* JVM –Ω–∏ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–∞:
  * –≤—Å—è–∫–∞ —Ä–µ—Ñ–µ—Ä–µ–Ω—Ü–∏—è –∫—ä–º immutable –æ–±–µ–∫—Ç —Å–æ—á–∏ –∫—ä–º –æ–±–µ–∫—Ç —Å –Ω–∞–ø—ä–ª–Ω–æ –≤–∞–ª–∏–¥–Ω–æ —Å—ä—Å—Ç–æ—è–Ω–∏–µ
* –Ω–µ–∏–∑–º–µ–Ω–∏–º–æ—Å—Ç—Ç–∞ –ø—Ä–µ–º–∞—Ö–≤–∞ –æ–≥—Ä–æ–º–µ–Ω –∫–ª–∞—Å –æ—Ç –≤—ä–∑–º–æ–∂–Ω–∏ –≥—Ä–µ—à–∫–∏

:::

# –ü—Ä–æ–±–ª–µ–º–∏ –Ω–∞ –Ω–∏—à–∫–∏—Ç–µ

::: incremental

* –¢–µ–∂–∫–∏ ‚Äì –≤—Å—è–∫–∞ –∏–º–∞ —Å—Ç–µ–∫, —Ä–µ–≥–∏—Å—Ç—Ä–∏, –ø—Ä–µ–≤–∫–ª—é—á–≤–∞–Ω–µ—Ç–æ –µ –±–∞–≤–Ω–æ –∏ –º–∏–Ω–∞–≤–∞ –ø—Ä–µ–∑ —è–¥—Ä–æ—Ç–æ –Ω–∞ –û–°, —Å—Ç–∞—Ä—Ç–∏—Ä–∞—Ç –±–∞–≤–Ω–æ
* –õ–∏–ø—Å–≤–∞ —Ä–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç
  * –Ω–æ –º–æ–≥–∞—Ç –∞–∫—Ç–∏–≤–Ω–æ –¥–∞ —Å—ä–∑–¥–∞–¥–∞—Ç –¥—Ä—É–≥–∏ –Ω–∏—à–∫–∏
  * –∏ –¥–∞ –ø—Ä–æ–º–µ–Ω—è—Ç —Å–ø–æ–¥–µ–ª–µ–Ω–æ —Å—ä—Å—Ç–æ—è–Ω–∏–µ
* –ö–æ–º—É–Ω–∏–∫–∏—Ä–∞—Ç
  * —á—Ä–µ–∑ —Å–ø–æ–¥–µ–ª–µ–Ω–æ —Å—ä—Å—Ç–æ—è–Ω–∏–µ
  * —á—Ä–µ–∑ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∏ –∏ –±–ª–æ–∫–∏—Ä–∞—â–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏<span class="fragment"> ‚Äì –¥–æ–∫–∞—Ç–æ –æ–ø–µ—Ä–∞—Ü–∏—è—Ç–∞ –Ω–µ –∑–∞–≤—ä—Ä—à–∏ –Ω–∏—à–∫–∞—Ç–∞ –Ω–µ –º–æ–∂–µ –¥–∞ –ø—Ä–∞–≤–∏ –Ω–∏—â–æ –¥—Ä—É–≥–æ</span>
* –ù–µ —Å–µ –∫–æ–º–ø–æ–∑–∏—Ä–∞—Ç
* [The Problem with Threads](https://www2.eecs.berkeley.edu/Pubs/TechRpts/2006/EECS-2006-1.pdf)

:::

# Callbacks


```scala
def doSomething(onComplete: Result => Unit): Unit
```

::: incremental

* –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∏ –∏ —Ä–µ–∞–∫—Ç–∏–≤–Ω–∏
* –ó–∞–¥–µ–π—Å—Ç–≤–∞—Ç —Å–µ –ø—Ä–∏ –∑–∞–≤—ä—Ä—à–≤–∞–Ω–µ –Ω–∞ —Ä–∞–±–æ—Ç–∞ –∏–ª–∏ –ø—Ä–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ —Å—ä–±–∏—Ç–∏–µ <span class="fragment">(–µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–∏ –∑–∞ event loop)</span>
* –©–µ –≥–∏ –∏–∑–ø—ä–ª–Ω–∏–º –≤—ä—Ä—Ö—É pool –æ—Ç –Ω–∏—à–∫–∏ (–±—Ä–æ–π = ~–±—Ä–æ–π —è–¥—Ä–∞)

:::

<div class="fragment">

```scala
def doSomethingDangerous(onComplete: Try[Result] => Unit): Unit
```

</div>

# Callbacks ‚Äì –Ω–µ–≥–∞—Ç–∏–≤–∏

::: incremental

* –ò–º–ø–µ—Ä–∞—Ç–∏–≤–Ω–∏, —Ä–∞–±–æ—Ç—è—Ç —Å mutable state
* –ù–µ–∫–æ–º–ø–æ–∑–∏—Ç–Ω–∏. Callback hell
* –ê–∫–æ —Å–µ –∏–∑–ø—ä–ª–Ω—è–≤–∞—Ç –≤ —Ä–∞–∑–ª–∏—á–Ω–∏ –Ω–∏—à–∫–∏, –∏–∑–∏—Å–∫–≤–∞—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
* –†—ä—á–Ω–æ —Å–ø—Ä—è–≤–∞–Ω–µ —Å –≥—Ä–µ—à–∫–∏

:::

# Future

–ö–∞–∫–≤–æ –±—è—Ö–º–µ –ø–æ—Å—Ç–∏–≥–Ω–∞–ª–∏ —Å `IO`?

::: incremental

* –°—Ç—Ä–∞–Ω–∏—á–µ–Ω –µ—Ñ–µ–∫—Ç =&gt; —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–µ–Ω –µ—Ñ–µ–∫—Ç
* –ó–∞—â–æ —Ç–æ–≤–∞ –Ω–∏ —Ö–∞—Ä–µ—Å–≤–∞?
* –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–Ω–æ –∫–æ–º–ø–æ–∑–∏—Ä–∞–Ω–µ –Ω–∞ –µ—Ñ–µ–∫—Ç–∏ (–ø–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏—è)
* –°—Ç—Ä–∞–Ω–∏—á–Ω–∏ –µ—Ñ–µ–∫—Ç–∏ —Å–∞–º–æ –ø—Ä–∏ –∏–∑–ø—ä–ª–Ω–µ–Ω–∏–µ

:::

#

–ö–∞–∫ –±–∏ –∏–∑–≥–ª–µ–∂–¥–∞–ª `Future`

# –ó–∞—â–æ —Ç–æ—á–Ω–æ —Ç–µ–∑–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏?

::: { .fragment }

[–õ–µ–∫—Ü–∏—è 2: –ò–º–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ —Å—Ä–µ—â—É –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–Ω–æ](02-fp-with-scala.html#/—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–Ω–æ-—Å—Ä–µ—â—É-–∏–º–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ)

:::

::: { .fragment }

–ü—Ä–∏ –∏–º–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ—Ç–æ –≤—Å—è–∫–∞ –Ω–∏—à–∫–∞ –æ–ø–∏—Å–≤–∞ —Å–æ–±—Å—Ç–≤–µ–Ω–∞ –≤—Ä–µ–º–µ–≤–∞ –ª–∏–Ω–∏—è, –ø—Ä–µ–ø–ª–∏—Ç–∞—â–∞ —Å–µ —Å –¥—Ä—É–≥–∏—Ç–µ

:::

# –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–Ω–æ –ø—Ä–æ–≥—Ä–∞–º–∏—Ä–∞–Ω–µ

![](images/02-fp-with-scala/functional-wizard.png){ height="512" }

# –ò–∑—Ä–∞–∑–∏

```scala
val a = 10
val b = 40

val c = a * 10
val d = (a, b)
val e = a + b

def f(x: Int): String = ???
def g(x: String): Boolean = ???

def r = f(g(a))
```

# –ï—Ñ–µ–∫—Ç–Ω–∏ –∏–∑—Ä–∞–∑–∏

```scala
val a = Future(10)
val b = Future(40)

val c = a.map(_ * 10)
val d = a zip b
val e = a.zipMap(b)(_ + _)

def f(n: Int): Future[String] = ???
def g(str: String): Future[Boolean] = ???

def r = a.flatMap(f).flatMap(g)
```

# –ï—Ñ–µ–∫—Ç–Ω–∏ –∏–∑—Ä–∞–∑–∏

```scala
val a = Future(10)
val b = Future(40)

val c = a.map(_ * 10)
val d = a zip b
val e = a.zipMap(b)(_ + _)

def f(n: Int): Future[String] = ???
def g(n: Int, str: String): Future[Boolean] = ???

def r = for {
  n <- a
  str <- f(n)
  bool <- g(n, str)
} yield bool
```

# –ò–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è. Eager –∏–ª–∏ lazy?

::: incremental

* –©–µ —Ä–∞–∑–≥–ª–µ–¥–∞–º–µ –∏ –¥–≤–∞—Ç–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞
* –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏—è Scala Future —Ä–∞–±–æ—Ç–∏ eagerly
* `Future` —Å–µ –∏–∑—á–∏—Å–ª—è–≤–∞ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ =&gt; –¥–æ–ø—É—Å—Ç–∏–º–æ –µ –¥–∞ —Å–µ –∏–∑—á–∏—Å–ª—è–≤–∞—Ç eagerly
* —Ç.–µ. –∏–∑—á–∏—Å–ª–µ–Ω–∏–µ—Ç–æ –¥–∞ –∑–∞–ø–æ—á–Ω–µ –≤–µ–¥–Ω–∞–≥–∞ —Å–ª–µ–¥ –¥–µ—Ñ–∏–Ω–∏—Ä–∞–Ω–µ—Ç–æ –∏ –∫–æ–≥–∞—Ç–æ —Å—Ç–∞–Ω–∞—Ç –≥–æ—Ç–æ–≤–∏ –≤—Å–∏—á–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
* –∫–æ–º–ø–æ–∑–∏—Ü–∏—è—Ç–∞ –Ω–∞ –µ—Ñ–µ–∫—Ç–∏—Ç–µ –æ—Å—Ç–∞–≤–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–Ω–æ

:::

# –ò–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è

# –†–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç –Ω–∞ `Future`

::: incremental

* –©–µ —Å–µ –±–∞–∑–∏—Ä–∞–º–µ –Ω–∞ callback ‚Äì `onComplete`
* –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–Ω–∏—Ç–µ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ ‚Äì —á—Ä–µ–∑ `onComplete`
* –¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∏—Ä–∞–Ω `Future` —Å—ä—â–æ –µ —Ä–µ–∞–∫—Ç–∏–≤–µ–Ω
* –ö–∞–∫ –¥–∞ –≥–æ –≤—ä—Ä–∂–µ–º —Å –≤—ä–Ω—à–Ω–∏ –∏–∑—Ç–æ—á–Ω–∏—Ü–∏ –Ω–∞ —Å—ä–±–∏—Ç–∏—è?
* Promise
  * Promise-–∏—Ç–µ —â–µ –≥–µ–Ω–µ—Ä–∏—Ä–∞—Ç –ø—ä—Ä–≤–æ–Ω–∞—á–∞–ª–Ω–∏ Future-–∏ –≤ –Ω–∞—à–∞—Ç–∞ —Å–∏—Å—Ç–µ–º–∞
  * –ê–¥–∞–ø—Ç–µ—Ä –∫—ä–º –≤—ä–Ω—à–Ω–∏—è —Å–≤—è—Ç ‚Äì —Ä–µ–∞–≥–∏—Ä–∞—Ç –Ω–∞ —Å—ä–±–∏—Ç–∏—è –∑–∞ –≤—Ö–æ–¥/–∏–∑—Ö–æ–¥

:::

<!--
  * –∏–∑–ø—ä–ª–Ω—è–≤–∞ —Å–µ –∫–æ–≥–∞—Ç–æ –Ω–µ–≥–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—Ç–∏ –∑–∞–≤—ä—Ä—à–∞—Ç (–∫–∞—Ç–æ —Ä–µ–∞–∫—Ü–∏—è)
  * –ø—Ä–∏ –∑–∞–≤—ä—Ä—à–≤–∞–Ω–µ –∑–∞–≤–∏—Å–∏–º–∏—Ç–µ –æ—Ç –Ω–µ–≥–æ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ –º–æ–≥–∞—Ç –¥–∞ —Å–µ –∏–∑–ø—ä–ª–Ω—è—Ç
-->

# –ü—Ä–∏–º–µ—Ä–∏

# Immutability

Future –µ –±–µ–∑–æ–ø–∞—Å–µ–Ω, —Å–∞–º–æ –∞–∫–æ —Å—Ç–æ–π–Ω–æ—Å—Ç–∏—Ç–µ –≤ –Ω–µ–≥–æ —Å–∞ immutable!

<p class="fragment">–ê–∫–æ –Ω–µ —Å–∞, —Ç–æ —Ç—è—Ö–Ω–æ—Ç–æ —Å—ä—Å—Ç–æ—è–Ω–∏–µ –º–æ–∂–µ –¥–∞ –µ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ</p>

# –ê—Å–∏–Ω—Ö—Ä–æ–Ω–µ–Ω –≤—Ö–æ–¥/–∏–∑—Ö–æ–¥ —á—Ä–µ–∑ `Future`

::: { .fragment }

–ö–∞–∫ —Ä–∞–±–æ—Ç–∏ HTTP?

:::

# `Future` –≤ Scala

* `scala.concurrent.Future`
* –ò–∑–ø–æ–ª–∑–≤–∞ `ExecutionContext` –≤–º–µ—Å—Ç–æ `Executor`
* default: `import scala.concurrent.ExecutionContext.Implicits.global`

# –°—ä—â–µ—Å—Ç–≤—É–≤–∞—â–∞ —Å—Ç–æ–π–Ω–æ—Å—Ç –∫—ä–º `Future`

```scala
Future.successful(value)
Future.failed(exception)
```

# Recover

```scala
def doSomethingForUser(userId: Id): Future[HttpResponse] =(for {
  user <- retrieveUser(userId)
  result <- doService(user, input)
} yield Ok(constructBody(result))) recover {
  case UserNotFound(userId) => NotFound
  case _: ActionNotPermitted => Unauthorized
}
```

# Recover with –¥—Ä—É–≥–∞, –ø–æ-—Å—Ç–∞–±–∏–ª–Ω–∞ –∞–ª—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞

```scala
def dangerousService(input: ServiceInput): Future[Result] = ???
def safeService(input: ServiceInput): Future[Result] = ???

def calculate(input: ServiceInput): Future[Result] = {
  dangerousService(input).recoverWith {
    case _: ServiceFailure => safeService(input)
  }
}
```

# –°—ä—Å—Ç–µ–∑–∞–Ω–∏–µ

```scala
def algorithm1(input: String): Future[Int] = ???
def algorithm2(input: String): Future[Int] = ???

def calculation(input: Stirng): Future[Int] =
  Future.firstCompletedOf(List(algorithm1(input), algorithm2(input)))

```

# –ù–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω –±—Ä–æ–π –Ω–µ–∑–∞–≤–∏—Å–∏–º–∏ –∏–∑—á–∏—Å–ª–µ–Ω–∏—è

```scala
def retrieveAge(userId: Id): Future[Int] = ???

def averageFriendsAge(user: User): Future[Option[Int]] = for {
  friendIds: List[Id] <- user.friends
  friendsAges: List[Future[Int]] = friendIds.map(retrieveAge)
  ages <- Future.sequence(friendsAges): Future[List[Int]]
} yield average(ages)
```

# –†–µ—Ñ–µ—Ä–µ–Ω—Ç–Ω–∞ –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç

```scala
def calc[T](expr: => T) = Future {
  Thread.sleep(4000)

  expr
}
```

::: { .fragment }

```scala
val futureA = calc(42)
val futureB = calc(10)

val sum = for {
  a <- futureA
  b <- futureB
} yield a + b

println {
  Await.result(sum, 5.seconds)
}
```

:::

::: { .fragment }

```
> 52
```

:::

# –†–µ—Ñ–µ—Ä–µ–Ω—Ç–Ω–∞ –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç

```scala
def calc[T](expr: => T) = Future {
  Thread.sleep(4000)

  expr
}
```

```scala
val sum = for {
  a <- calc(42)
  b <- calc(10)
} yield a + b

println {
  Await.result(sum, 5.seconds)
}
```

::: { .fragment }

```
> Exception in thread "main" java.util.concurrent.TimeoutException: Futures timed out after [5 seconds]
```

:::

# –ü—Ä–∞–≤–∏–ª–Ω–∏—è—Ç –Ω–∞—á–∏–Ω –¥–∞ –ø–æ—Å—Ç–∏–≥–Ω–µ–º –ø–∞—Ä–∞–ª–µ–ª–∏–ª–∏–∑—ä–º:

```scala
val sum = for {
  (a, b) <- calc(42).zip(calc(10))
} yield a + b

println {
  Await.result(sum, 5.seconds)
}
```

```
> 52
```

# –ö–∞–∫ –¥–∞ —Å–µ —Å–ø—Ä–∞–≤–∏–º —Å —Ç–æ–≤–∞?

::: { .fragment }

–û—Ç–≥–æ–≤–æ—Ä —Å–ª–µ–¥–≤–∞—â–∏—è –ø—ä—Ç üòä

:::

# –í—ä–ø—Ä–æ—Å–∏ :)?
